{% extends 'main_pages/base.html' %}
{% load static %}
{% load tz %}

{% block head_title %}Home{% endblock head_title %}

{% block content %}

{% include 'includes/navbar.html' %}

<style>
  .rating-stars {
    display: flex;
    justify-content: left;
    align-items: center;
    margin-bottom: 10px;
  }

  .star {
    font-size: 24px;
    color: grey;
    transition: color 0.3s ease-in-out;
    display: inline-block;
  }

  .yellow {
    color: gold;
  }
</style>

<!-- ======= Breadcrumb Start ======= -->
<nav aria-label="breadcrumb" class="container-fluid mt-5 pt-5">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="#">Home</a></li>
    <li class="breadcrumb-item"><a href="#">Business</a></li>
    <li class="breadcrumb-item active" aria-current="page">Catalog</li>
  </ol>
</nav>
<!-- Breadcrumb End -->
    <!-- Messages div -->
    {% if messages %}
      <div class="alert alert-dismissible {% if messages.tags %}alert-{{ messages.tags }}{% endif %}">
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        {% for message in messages %}
          {{ message }}
        {% endfor %}
      </div>
    {% endif %}

<div class="container-fluid">
  <ul class="d-inline-flex list-inline">
    <li class="pe-2">
      {% for rating in ratings %}
      <div class="rating-stars">
        {% for _ in "12345" %}
          {% if forloop.counter <= rating.rating %}
            <label class="star yellow">&#9733;</label>
          {% else %}
            <label class="star">&#9733;</label>
          {% endif %}
        {% endfor %}
        ({{ rating.rating }})
      </div>
      </li>
      {% empty %}
      <li class="list-group-item pe-3">
        <div class="star-icons">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
          </svg>
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-star" viewBox="0 0 16 16">
            <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.56.56 0 0 0-.163-.505L1.71 6.745l4.052-.576a.53.53 0 0 0 .393-.288L8 2.223l1.847 3.658a.53.53 0 0 0 .393.288l4.052.575-2.906 2.77a.56.56 0 0 0-.163.506l.694 3.957-3.686-1.894a.5.5 0 0 0-.461 0z"/>
          </svg>
              </div>
      {% endfor %}
    </li>
    <li class="pe-2">
      <div class="mb-3">
        {% timezone "Africa/Johannesburg" %}
            {% now "l" as current_day %}
            {% now "H:i" as current_time %}
          {% endtimezone %}
          <div class="mb-3">
            <strong>Current Day Status:</strong>
            {% for working_hours in working_hours_list %}
              {% if current_day == working_hours.day %}
                {% if not working_hours.closed %}
                  {% if working_hours.opening_time and working_hours.closing_time %}
                    {% with opening_time=working_hours.opening_time|time:"H:i" closing_time=working_hours.closing_time|time:"H:i" %}
                      {% if current_time >= opening_time and current_time <= closing_time %}
                        <span class="text-success">Open</span>
                      {% elif current_time < opening_time %}
                        <span class="text-danger">Closed - Not Opened Yet</span>
                      {% elif current_time > closing_time %}
                        <span class="text-danger">Closed - Already Closed</span>
                      {% endif %}
                    {% endwith %}
                  {% else %}
                    <span class="text-danger">Closed - Day Mismatch</span>
                  {% endif %}
                {% else %}
                  <span class="text-danger">Closed - Explicitly Closed</span>
                {% endif %}
              {% endif %}
            {% endfor %}
          </div>
      </div>
    </li>
    <li class="pe-2">Get Directions</li>
  </ul>
</div>

<!-- ======= About Section Start ======= -->
<section class="pt-5 mt-5 pb-5" id="about">
  <div class="container-fluid pt-5 pb-5">
    <div class="row g-5">
      <div class="col-lg-5 col-md-6 col-sm-12 wow fadeIn" data-wow-delay=".3s">
        <div class="h-100 position-relative">
          {% for catalog in catalogs %}
          <img src="{{ catalog.business_cover_pic.url}}" class="img-fluid w-100 rounded" name="business_cover_pic" alt="business-image">
          <div class="position-absolute w-75" style="top: 5%; left: 0%;">
            <img src="{{ catalog.business_logo.url }}" class="img-fluid w-75 rounded bg-dark" name="business_logo" alt="business-logo">
          </div>
        </div>
      </div>
      <div class="col-lg-7 col-md-6 col-sm-12 wow fadeIn" data-wow-delay=".5s">
        <h5 class="text-primary">About Us</h5>
        <h1 class="mb-4 display-1 text-uppercase text-dark">{{ catalog.business_name }}</h1>
        <p>{{ catalog.bio }}</p>
          {% endfor %}
      </div>
    </div>
  </div>
</section>
<!-- About Section End -->

<!-- ======= Services Section Start ======= -->
<section class="bg-light pt-5 pb-5" id="services">
  <div class="container-fluid pb-5">
    <div class="h-100 d-flex flex-column justify-content-center align-items-center p-5">
      <p class="d-inline-flex bg-dark text-primary py-1 px-4 ">Price & Plan</p>
      <h1 class="text-uppercase mb-4">Check Out Our Services And Prices</h1>
    </div>

    <div class="row g-5">
      <div class="col-lg-5 col-md-6 col-sm-12 wow fadeIn" data-wow-delay=".3s">
        <div class="card mb-3 border-0 rounded-0 shadow-sm">
          <div class="card-body">
            <h2 class="card-title">Best Vision Salon</h2>
            <p class="card-text">Ratings</p>
            <a href="#" class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#appointmentModal">Book Now</a>
          </div>
        </div>
      </div>
      <div class="col-lg-7 col-md-6 col-sm-12 wow fadeIn" data-wow-delay=".5s">
        <table class="table shadow-sm">
          <thead>
            <tr>
              <th scope="col">Service Name</th>
              <th scope="col">Description</th>
              <th scope="col">Price (R)</th>
              <th scope="col">Book</th>
            </tr>
          </thead>
          <tbody class="table-group-divider">
            {% for service in services %}
              <tr>
                <td>{{ service.name }}</td>
                <td>{{ service.description }}</td>
                <td>R{{ service.price }}</td>
                <td>
                  <a href="#" class="btn btn-secondary btn-sm book-now-btn" data-bs-toggle="modal" data-bs-target="#appointmentModal" data-service-id="{{ service.id }}">Book Now</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>
<!-- Services Section End -->

<!-- ======= Working Hours Section Start ======= -->
<section class="pt-5 pb-5" id="working-hours">
  <div class="container-fluid pt-5 pb-5">
    <div class="row g-5">
      <div class="col-lg-6 col-md-6 col-sm-12 wow fadeIn" data-wow-delay=".3s">
        <div class="bg-secondary h-100 d-flex flex-column justify-content-center p-5">
          <p class="d-inline-flex bg-dark text-primary py-1 px-4 me-auto">Working Hours</p>
          <h1 class="text-uppercase mb-4">Professional Barbers Are Waiting For You</h1>

          {% for working_hours in working_hours_list %}
            <div class="d-flex justify-content-between border-bottom py-2 {% if working_hours.day == current_day %}current-day{% endif %}">
              <h6 class="text-uppercase mb-0">{{ working_hours.day }}</h6>
              {% if not working_hours.closed %}
                <span class="text-uppercase">{{ working_hours.opening_time|time:"H:i" }} - {{ working_hours.closing_time|time:"H:i" }}</span>
              {% else %}
                <span class="text-uppercase text-primary">Closed</span>
              {% endif %}
            </div>
          {% endfor %}
        </div>
      </div>
      <div class="col-lg-6 col-md-6 col-sm-12 wow fadeIn" data-wow-delay=".3s">
        <div class="h-100">
          <img class="img-fluid h-100" src="{% static 'assets/images/about-2.jpg' %}" alt="">
        </div>
      </div>
    </div>
  </div>
</section>
<!-- Working Hours Section End -->

<!-- Appointment Modal Start -->
<div class="modal fade" id="appointmentModal" tabindex="-1" aria-labelledby="appointmentModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="appointmentModalLabel">Book Appointment</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form method="post" action="{% url 'appointment_create' %}" id="appointmentForm">
          {% csrf_token %}
          <div class="mb-3">
              <label for="service" class="form-label">Service</label>
              <select class="form-select" id="service" name="service">
                {% for service in services %}
                <option value="{{ service.id }}">{{ service.name }} - {{ service.price }}</option>
                {% endfor %}
              </select>
            </div>
          
          <div class="mb-3">
              <label for="date" class="form-label">Date</label>
              <input type="date" class="form-control" id="date" name="date">
          </div>
          <div class="mb-3">
              <label for="time" class="form-label">Time</label>
              <input type="time" class="form-control" id="time" name="time">
          </div>
          <div class="mb-3">
              <label for="note" class="form-label">Note</label>
              <textarea class="form-control" id="note" name="note"></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
          <a href="{% url 'appointment_list' %}" class="btn btn-secondary">Cancel</a>
      </form>
      </div>
    </div>
  </div>
</div>
<!-- Appointment Modal End -->

<script>
  document.addEventListener('DOMContentLoaded', function () {
    var bookNowButtons = document.querySelectorAll('.book-now-btn');

    bookNowButtons.forEach(function (button) {
      button.addEventListener('click', function () {
        var serviceId = button.dataset.serviceId;
        document.getElementById('service').value = serviceId;
      });
    });
  });


  document.addEventListener('DOMContentLoaded', function () {
    const ratingStarsModal = document.getElementById('rating-stars-modal');
    const selectedRatingInputModal = document.getElementById('selected-rating-modal');

    // Set the initial star colors based on the selected rating
    updateStars(selectedRatingInputModal.value, ratingStarsModal);

    ratingStarsModal.addEventListener('click', function (event) {
      const clickedLabel = event.target.closest('label');
      if (clickedLabel) {
        const value = clickedLabel.getAttribute('data-value');
        selectedRatingInputModal.value = value;
        // Update the appearance of the stars
        updateStars(value, ratingStarsModal);
      }
    });

    function updateStars(value, starsContainer) {
      const labels = starsContainer.querySelectorAll('label');
      labels.forEach(function (label) {
        const labelValue = label.getAttribute('data-value');
        label.style.color = labelValue <= value ? 'gold' : 'grey';
      });
    }
  });


</script>


{% include 'includes/footer.html' %}

{% endblock content %}
